<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é¦–çˆ¾è¡Œç¨‹å°èˆªåŠ©æ‰‹ v8.0 (åœ°åœ–å…¨è¦½ç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Leaflet CSS & JS (ç”¨æ–¼é¡¯ç¤ºå…è²»åœ°åœ–) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif; background-color: #f3f4f6; }
        .card { background: white; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .btn-google { background-color: #4285F4; color: white; }
        .btn-naver { background-color: #03C75A; color: white; }
        select { -webkit-appearance: none; }
        .modal-content::-webkit-scrollbar { width: 4px; }
        .modal-content::-webkit-scrollbar-thumb { background-color: #ccc; border-radius: 4px; }
        .ai-active { color: #8b5cf6; text-shadow: 0 0 10px rgba(139, 92, 246, 0.5); }
        .ai-pulse { animation: pulse-purple 2s infinite; }
        /* Map Styles */
        #global-map { height: 400px; width: 100%; border-radius: 16px; z-index: 0; }
        .category-scroll::-webkit-scrollbar { display: none; } /* Hide scrollbar for category list */
        .category-scroll { -ms-overflow-style: none; scrollbar-width: none; }
        @keyframes pulse-purple {
            0% { box-shadow: 0 0 0 0 rgba(139, 92, 246, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(139, 92, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(139, 92, 246, 0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // åœ°é»åˆ†é¡å®šç¾©
        const CATEGORIES = {
            ALL: "å…¨éƒ¨",
            SHOPPING: "ğŸ›ï¸ è³¼ç‰©/æœé£¾",
            FOOD: "ğŸ½ï¸ ç¾é£Ÿ/å’–å•¡",
            MUSIC: "ğŸ¸ æ¨‚å™¨/éŸ³æ¨‚",
            ATTRACTION: "ğŸ“· æ™¯é»/é«”é©—",
            OTHER: "ğŸ¨ ä½å®¿/å…¶ä»–"
        };

        // é è¨­åœ°é»æ•¸æ“šåº« (å·²æ›´æ–°è‡³ v7.1 ä¸¦åŠ å…¥åˆ†é¡)
        const defaultLocations = [
            // --- è³¼ç‰©/æœé£¾ ---
            { id: 3, name: "å¼˜å¤§-SPAO", krName: "ìŠ¤íŒŒì˜¤ í™ëŒ€", lat: 37.5559, lng: 126.9238, desc: "å¼˜å¤§9è™Ÿå‡ºå£é™„è¿‘", category: "SHOPPING" },
            { id: 4, name: "å¼˜å¤§-TOP TEN", krName: "íƒ‘í… í™ëŒ€", lat: 37.5558, lng: 126.9239, desc: "å¼˜å¤§9è™Ÿå‡ºå£é™„è¿‘", category: "SHOPPING" },
            { id: 5, name: "å¼˜å¤§-MLB", krName: "MLB í™ëŒ€", lat: 37.5560, lng: 126.9237, desc: "å¼˜å¤§9è™Ÿå‡ºå£é™„è¿‘", category: "SHOPPING" },
            { id: 6, name: "å¼˜å¤§-å–„è‰¯çš„çš®é‹", krName: "ì°©í•œêµ¬ë‘ í™ëŒ€", lat: 37.5563, lng: 126.9272, desc: "å¼˜å¤§8è™Ÿå‡ºå£æ­¥è¡Œ10åˆ†", category: "SHOPPING" },
            { id: 7, name: "å¼˜å¤§-å¤§å‰µ (Daiso)", krName: "ë‹¤ì´ì†Œ í™ëŒ€2í˜¸ì ", lat: 37.5574, lng: 126.9258, desc: "4è™Ÿå‡ºå£å¤§æ¨“", category: "SHOPPING" },
            { id: 8, name: "å¼˜å¤§-Nyunyu", krName: "ë‰´ë‰´ í™ëŒ€", lat: 37.5532, lng: 126.9213, desc: "é£¾å“åº—", category: "SHOPPING" },
            { id: 10, name: "å¼˜å¤§-HDEXæ——è‰¦åº—", krName: "ì—ì´ì¹˜ë±ìŠ¤", lat: 37.5505, lng: 126.9217, desc: "å¥èº«æœé£¾", category: "SHOPPING" },
            { id: 11, name: "å¼˜å¤§-Olive Young (éŠæ¨‚å ´åº—)", krName: "ì˜¬ë¦¬ë¸Œì˜ í™ëŒ€ë†€ì´í„°ì ", lat: 37.5528, lng: 126.9235, desc: "HEDXéŠæ¨‚å ´åˆ†åº—æ—", category: "SHOPPING" },
            { id: 12, name: "å¼˜å¤§å¥³äººè¡—", krName: "í™ëŒ€ ê±·ê³ ì‹¶ì€ê±°ë¦¬", lat: 37.5568, lng: 126.9246, desc: "8è™Ÿå‡ºå£é™„è¿‘", category: "SHOPPING" },
            { id: 13, name: "AK PLAZA å¼˜å¤§", krName: "AKí”Œë¼ì í™ëŒ€", lat: 37.5574, lng: 126.9259, desc: "4è™Ÿå‡ºå£", category: "SHOPPING" },
            { id: 16, name: "å»¶å—æ´-JUUNEEDU (ç¡è¡£)", krName: "ì¥¬ë‹ˆì¥¬", lat: 37.5618, lng: 126.9268, desc: "å»¶å—æ´", category: "SHOPPING" },
            { id: 21, name: "å¼˜å¤§-LOOF (è¡£æœåº—)", krName: "ë£¨í”„", lat: 37.5532, lng: 126.9223, desc: "å¼˜å¤§å•†åº—è¡— B1", category: "SHOPPING" },
            { id: 25, name: "å¼˜å¤§-HDEX éŠæ¨‚å ´åˆ†åº—", krName: "ì—ì´ì¹˜ë±ìŠ¤ í™ëŒ€ë†€ì´í„°ì ", lat: 37.5528, lng: 126.9235, desc: "éŠæ¨‚å ´æ—", category: "SHOPPING" },
            { id: 26, name: "å¼˜å¤§-EPT 4è™Ÿåº—", krName: "EPT í™ëŒ€", lat: 37.5487, lng: 126.9218, desc: "12:00â€“22:00", category: "SHOPPING" },
            { id: 27, name: "å¼˜å¤§-NONFICTION (é¦™æ°´)", krName: "ë…¼í”½ì…˜ í™ëŒ€", lat: 37.5559, lng: 126.9238, desc: "å¼˜å¤§å…¥å£ç«™é™„è¿‘", category: "SHOPPING" },
            { id: 28, name: "ä»å·æ©Ÿå ´-NONFICTION T1", krName: "ë…¼í”½ì…˜ ì¸ì²œê³µí•­ T1", lat: 37.4485, lng: 126.4525, desc: "T1 æ–°ç¾…å…ç¨…åº—3F", category: "SHOPPING" },
            { id: 29, name: "è ¶å®¤-NONFICTION æ¨‚å¤©ä¸–ç•Œ", krName: "ë…¼í”½ì…˜ ë¡¯ë°ì›”ë“œëª°", lat: 37.5125, lng: 127.1025, desc: "æ¨‚å¤©ä¸–ç•Œè³¼ç‰©ä¸­å¿ƒ 1F", category: "SHOPPING" },
            { id: 30, name: "ä¸‰æ¸…æ´-NONFICTION", krName: "ë…¼í”½ì…˜ ì‚¼ì²­", lat: 37.5825, lng: 126.9818, desc: "å®‰åœ‹ç«™2è™Ÿå‡ºå£", category: "SHOPPING" },
            { id: 31, name: "å¼˜å¤§-Youssoful (é¦™æ°´)", krName: "ìœ ì˜í’€ ì—°ë‚¨", lat: 37.5620, lng: 126.9255, desc: "å¼˜å¤§3è™Ÿå‡ºå£", category: "SHOPPING" },
            { id: 33, name: "å¼˜å¤§-Fennec Station", krName: "í˜ë„¥ ìŠ¤í…Œì´ì…˜", lat: 37.5515, lng: 126.9195, desc: "12:00-21:00", category: "SHOPPING" },
            { id: 34, name: "å¼˜å¤§-Object (æ–‡å…·)", krName: "ì˜¤ë¸Œì íŠ¸ ì„œêµ", lat: 37.5558, lng: 126.9298, desc: "12:00-21:00", category: "SHOPPING" },
            { id: 36, name: "è–æ°´æ´-29cm.home", krName: "ì´êµ¬í™ˆ ì„±ìˆ˜", lat: 37.5445, lng: 127.0565, desc: "11:00-22:00", category: "SHOPPING" },
            { id: 40, name: "å¼˜å¤§-as'on", krName: "ì• ì¦ˆì˜¨", lat: 37.5540, lng: 126.9220, desc: "12:00â€“21:00", category: "SHOPPING" },
            { id: 41, name: "æ±å¤§é–€-North Face White Label", krName: "ë…¸ìŠ¤í˜ì´ìŠ¤ ë˜ë˜ë™ëŒ€ë¬¸", lat: 37.5668, lng: 127.0095, desc: "Dundun B2", category: "SHOPPING" },
            { id: 42, name: "æ¼¢å—æ´-North Face", krName: "ë…¸ìŠ¤í˜ì´ìŠ¤ í•œë‚¨", lat: 37.5365, lng: 127.0015, desc: "1F", category: "SHOPPING" },
            { id: 43, name: "æ˜æ´-North Face (æ–°ä¸–ç•Œ)", krName: "ë…¸ìŠ¤í˜ì´ìŠ¤ ì‹ ì„¸ê³„ ë³¸ì ", lat: 37.5609, lng: 126.9810, desc: "æ–°ä¸–ç•Œç™¾è²¨æ–°é¤¨5F", category: "SHOPPING" },
            { id: 44, name: "å¼˜å¤§-Musinsa Standard", krName: "ë¬´ì‹ ì‚¬ ìŠ¤íƒ ë‹¤ë“œ í™ëŒ€", lat: 37.5553, lng: 126.9223, desc: "å¼˜å¤§9è™Ÿå‡ºå£æ—", category: "SHOPPING" },
            { id: 45, name: "å¼˜å¤§-WORKSOUT (Ryse)", krName: "ì›ìŠ¤ì•„ì›ƒ í™ëŒ€ ë¼ì´ì¦ˆ", lat: 37.5546, lng: 126.9216, desc: "Ryseé£¯åº—å…§", category: "SHOPPING" },
            { id: 46, name: "å¼˜å¤§-North Face æ——è‰¦åº—", krName: "ë…¸ìŠ¤í˜ì´ìŠ¤ í™ëŒ€ì ", lat: 37.5545, lng: 126.9215, desc: "å«White Label", category: "SHOPPING" },
            { id: 47, name: "å¼˜å¤§-thisisneverthat", krName: "ë””ìŠ¤ì´ì¦ˆë„¤ë²„ëŒ“ í™ëŒ€", lat: 37.5525, lng: 126.9218, desc: "æ——è‰¦åº—", category: "SHOPPING" },
            { id: 48, name: "å»¶å—æ´-Omni People Heavy", krName: "ì˜´ë‹ˆí”¼í”Œ í—¤ë¹„", lat: 37.5620, lng: 126.9255, desc: "å¤è‘—é¸è²¨", category: "SHOPPING" },
            { id: 49, name: "å»¶å—æ´-WILD BRICKS", krName: "ì™€ì¼ë“œë¸Œë¦­ìŠ¤", lat: 37.5622, lng: 126.9258, desc: "é…ä»¶/å¸½é£¾", category: "SHOPPING" },
            { id: 50, name: "åˆäº•-JOE'S GARAGE", krName: "ì¡°ìŠ¤ê°œëŸ¬ì§€", lat: 37.5498, lng: 126.9188, desc: "é¢¨æ ¼é¸ç‰©", category: "SHOPPING" },

            // --- ç¾é£Ÿ/å’–å•¡ ---
            { id: 14, name: "å¼˜å¤§-è±šå£½ç™¾è±¬è‚‰æ¹¯é£¯", krName: "ëˆìˆ˜ë°± í™ëŒ€ì§ì˜ì ", lat: 37.5559, lng: 126.9232, desc: "24å°æ™‚ç‡Ÿæ¥­", category: "FOOD" },
            { id: 15, name: "å¼˜å¤§-è‡ªç„¶é“é¹½éºµåŒ…", krName: "ìì—°ë„ì†Œê¸ˆë¹µ", lat: 37.5583, lng: 126.9242, desc: "2è™Ÿå‡ºå£é™„è¿‘", category: "FOOD" },
            { id: 17, name: "å»¶å—æ´-Hippo Brunch House", krName: "íˆí¬ ë¸ŒëŸ°ì¹˜í•˜ìš°ìŠ¤", lat: 37.56437, lng: 126.92535, desc: "09:00-21:30", category: "FOOD" },
            { id: 18, name: "å»¶ç¦§æ´-Grain Seoul", krName: "ê·¸ë ˆì¸ ì„œìš¸", lat: 37.56847, lng: 126.93045, desc: "æ—©åˆé¤ 09:00-17:30", category: "FOOD" },
            { id: 19, name: "å¼˜å¤§-21ä¸–ç´€æˆ‘å€‘å¤§æµ·æ°´ç”¢", krName: "21ì„¸ê¸° ìš°ë¦¬ë°”ë‹¤ìˆ˜ì‚°", lat: 37.5566, lng: 126.9208, desc: "ç”Ÿé­šç‰‡/å¼˜å¤§1è™Ÿå‡ºå£", category: "FOOD" },
            { id: 20, name: "æ˜æ´-å­è«‡åˆ€å‰Šéºµä¸€éš»é›", krName: "íš¨ë‹´ì¹¼êµ­ìˆ˜ ë‹­í•œë§ˆë¦¬", lat: 37.5627, lng: 126.9852, desc: "æ˜æ´ç¸½åº— B1", category: "FOOD" },
            { id: 22, name: "å»¶å—æ´-Heod æ—©åˆé¤", krName: "í•´ì˜« ì—°ë‚¨", lat: 37.5653, lng: 126.9247, desc: "11:00-21:00", category: "FOOD" },
            { id: 32, name: "å¼˜å¤§-The Grazing Pig (æ°´èŠ¹)", krName: "í’€ëœ¯ëŠ”ë¼ì§€", lat: 37.5612, lng: 126.9262, desc: "12:00-22:00", category: "FOOD" },
            { id: 35, name: "æ–°æ²™æ´-å…ƒç¥–é¦¬å±± (é†¬èŸ¹)", krName: "ì›ì¡°ë§ˆì‚°ì•„êµ¬ì°œ", lat: 37.5145, lng: 127.0195, desc: "æ–°æ²™æ´é†¬èŸ¹è€åº—", category: "FOOD" },
            { id: 38, name: "å®‰åœ‹-å€«æ•¦è²æœåšç‰©é¤¨", krName: "ëŸ°ë˜ë² ì´ê¸€ë®¤ì§€ì—„ ì•ˆêµ­", lat: 37.5792, lng: 126.9865, desc: "07:00â€“17:30", category: "FOOD" },
            { id: 39, name: "é˜è·¯-ç„¡å¢å±‹ (äººè”˜é›)", krName: "ë¬´êµ¬ì˜¥", lat: 37.5765, lng: 126.9835, desc: "åŒ—éŸ“äººè”˜é›æ¹¯", category: "FOOD" },

            // --- æ¨‚å™¨/éŸ³æ¨‚ ---
            { id: 23, name: "å®‰é¤Š-Bass Gosu Shop", krName: "ë² ì´ìŠ¤ê³ ìˆ˜ìƒµ", lat: 37.38257, lng: 126.95830, desc: "æ¨‚å™¨è¡Œ/ç±³å®¶ç•œç”¢æ—", category: "MUSIC" },
            { id: 51, name: "å¼˜å¤§-Buzzbee", krName: "ë²„ì¦ˆë¹„", lat: 37.5562, lng: 126.9305, desc: "ç²¾å“æ•ˆæœå™¨/é«˜éšç´", category: "MUSIC" },
            { id: 52, name: "é˜è·¯-æ¨‚åœ’æ¨‚å™¨å•†è¡—", krName: "ë‚™ì›ì•…ê¸°ìƒê°€", lat: 37.5735, lng: 126.9885, desc: "é˜è·¯ä¸‰è¡—ç«™5è™Ÿå‡ºå£", category: "MUSIC" },
            { id: 53, name: "é˜è·¯-Guitar Plant", krName: "ê¸°íƒ€í”ŒëœíŠ¸", lat: 37.5735, lng: 126.9885, desc: "æ¨‚åœ’å•†è¡—2F B230", category: "MUSIC" },

            // --- æ™¯é»/é«”é©— ---
            { id: 2, name: "å¼˜å¤§-æ©¡å­æ¼«ç•«", krName: "ë„í† ë¦¬ìºë¦¬ì»¤ì³", lat: 37.5614, lng: 126.9255, desc: "å»¶å—æ´æœ¬åº—", category: "ATTRACTION" },
            { id: 37, name: "åŒ—æ‘éŸ“å±‹æ‘", krName: "ë¶ì´Œí•œì˜¥ë§ˆì„", lat: 37.5828, lng: 126.9835, desc: "æ¡‚æ´è¡—37", category: "ATTRACTION" },

            // --- ä½å®¿/å…¶ä»– ---
            { id: 1, name: "æ˜æ´å¤§ä½¿é¤¨æ›éŒ¢æ‰€", krName: "ëŒ€ì‚¬ê´€ì•í™˜ì „", lat: 37.5635, lng: 126.9837, desc: "æ˜æ´2è¡—105è™Ÿ", category: "OTHER" },
            { id: 9, name: "å¼˜å¤§-å¼˜ç›Šè—¥å±€", krName: "í™ìµì•½êµ­", lat: 37.5572, lng: 126.9244, desc: "8è™Ÿå‡ºå£æ­¥è¡Œ1åˆ†", category: "OTHER" },
            { id: 24, name: "å¼˜å¤§-L7 Hongdae Hotel", krName: "L7 í™ëŒ€", lat: 37.5553, lng: 126.9223, desc: "å¼˜å¤§å…¥å£ç«™1è™Ÿå‡ºå£", category: "OTHER" }
        ];

        function App() {
            // Data & State
            const [customLocs, setCustomLocs] = React.useState([]);
            const [sheetLocs, setSheetLocs] = React.useState([]);
            const [filterCategory, setFilterCategory] = React.useState('ALL'); // é è¨­é¡¯ç¤ºå…¨éƒ¨
            
            const [startPoint, setStartPoint] = React.useState("current");
            const [endPoint, setEndPoint] = React.useState(defaultLocations[1].id);
            const [userLocation, setUserLocation] = React.useState(null);
            
            // UI Modals
            const [showSettingsModal, setShowSettingsModal] = React.useState(false);
            const [showAddModal, setShowAddModal] = React.useState(false);
            const [showAiModal, setShowAiModal] = React.useState(false);

            // Manual Add State
            const [newLocName, setNewLocName] = React.useState("");   
            const [newLocKrName, setNewLocKrName] = React.useState(""); 
            const [newLocNote, setNewLocNote] = React.useState("");
            const [newLocLat, setNewLocLat] = React.useState("");
            const [newLocLng, setNewLocLng] = React.useState("");
            const [newLocCategory, setNewLocCategory] = React.useState("OTHER"); // æ–°å¢åœ°é»çš„åˆ†é¡

            const allLocations = [...defaultLocations, ...customLocs, ...sheetLocs];

            // æ ¹æ“šåˆ†é¡ç¯©é¸å¾Œçš„æ¸…å–®
            const filteredLocations = React.useMemo(() => {
                if (filterCategory === 'ALL') return allLocations;
                return allLocations.filter(loc => loc.category === filterCategory || (loc.isCustom && newLocCategory === filterCategory)); 
                // Note: ç°¡å–®èµ·è¦‹ï¼ŒSheetå’ŒCustomç›®å‰æ²’æœ‰å®Œæ•´åˆ†é¡æ¬„ä½ï¼Œæš«æ™‚éƒ½é¡¯ç¤ºï¼Œæˆ–éœ€æ”¹é€²çµæ§‹
                // ä¿®æ­£ï¼šç‚ºäº†è®“ç¯©é¸æ›´æº–ç¢ºï¼Œæˆ‘å€‘å‡è¨­ Sheet/Custom è³‡æ–™å¦‚æœæ²’åˆ†é¡å°±æ­¸é¡åœ¨ OTHERï¼Œæˆ–è€…é¡¯ç¤ºåœ¨ ALL
                // é€™è£¡ç‚ºäº†å„ªåŒ–é«”é©—ï¼Œå¦‚æœä½¿ç”¨è€…é¸äº†åˆ†é¡ï¼Œæˆ‘å€‘ä¸»è¦ç¯©é¸ defaultLocationsï¼Œå°æ–¼ custom/sheet ç›¡é‡é¡¯ç¤ºæˆ–éœ€ä½¿ç”¨è€…è‡ªå·±å¡«åˆ†é¡
                // æš«æ™‚é‚è¼¯ï¼šåªç¯©é¸ defaultLocationsï¼ŒCustom/Sheet è‹¥ç„¡ category å±¬æ€§å‰‡åªåœ¨ ALL å‡ºç¾
            }, [allLocations, filterCategory]);

            // Leaflet Map Ref
            const mapRef = React.useRef(null);
            const markersRef = React.useRef([]);

            // Init
            React.useEffect(() => {
                // Load Custom Locations
                const savedLocs = localStorage.getItem('myCustomLocations');
                if (savedLocs) {
                    try { setCustomLocs(JSON.parse(savedLocs)); } catch(e){}
                }
                getUserLocation();
            }, []);

            // Leaflet Map Initialization
            React.useEffect(() => {
                if (!document.getElementById('global-map')) return;
                
                // å¦‚æœåœ°åœ–é‚„æ²’åˆå§‹åŒ–
                if (!mapRef.current) {
                    mapRef.current = L.map('global-map').setView([37.56, 126.98], 11); // é è¨­é¦–çˆ¾ä¸­å¿ƒ
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '&copy; OpenStreetMap contributors'
                    }).addTo(mapRef.current);
                }

                // æ¸…é™¤èˆŠæ¨™è¨˜
                markersRef.current.forEach(marker => marker.remove());
                markersRef.current = [];

                // åŠ å…¥æ‰€æœ‰åœ°é»æ¨™è¨˜
                allLocations.forEach(loc => {
                    if (loc.lat && loc.lng) {
                        const marker = L.marker([loc.lat, loc.lng])
                            .addTo(mapRef.current)
                            .bindPopup(`
                                <div style="text-align:center;">
                                    <b>${loc.name}</b><br/>
                                    <span style="font-size:10px; color:gray;">${loc.krName || ''}</span><br/>
                                    <a href="https://map.naver.com/p/search/${encodeURIComponent(loc.krName || loc.name)}" target="_blank" style="color:blue; text-decoration:underline;">Naver Map</a>
                                </div>
                            `);
                        markersRef.current.push(marker);
                    }
                });

            }, [allLocations]); // ç•¶åœ°é»è³‡æ–™æ”¹è®Šæ™‚é‡ç¹ª

            const getUserLocation = () => {
                if (!navigator.geolocation) return;
                navigator.geolocation.getCurrentPosition((pos) => {
                    setUserLocation({ lat: pos.coords.latitude, lng: pos.coords.longitude });
                });
            };

            const getLocData = (id) => {
                if (id === "current") return userLocation ? { name: "æˆ‘çš„ç›®å‰ä½ç½®", krName: "ë‚´ ìœ„ì¹˜", lat: userLocation.lat, lng: userLocation.lng } : null;
                return allLocations.find(l => l.id == id);
            };

            const startLoc = getLocData(startPoint);
            const endLoc = getLocData(endPoint);
            
            let distanceDisplay = "---";
            if (startLoc && endLoc) {
                const R = 6371; 
                const dLat = (endLoc.lat - startLoc.lat) * Math.PI / 180;
                const dLon = (endLoc.lng - startLoc.lng) * Math.PI / 180;
                const a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(startLoc.lat * Math.PI / 180) * Math.cos(endLoc.lat * Math.PI / 180) * Math.sin(dLon/2) * Math.sin(dLon/2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
                distanceDisplay = (R * c).toFixed(2);
            }

            const openMap = (type) => {
                if (!startLoc || !endLoc) return;
                if (type === 'google') {
                    window.open(`https://www.google.com/maps/dir/?api=1&origin=${startLoc.lat},${startLoc.lng}&destination=${endLoc.lat},${endLoc.lng}&travelmode=transit`, '_blank');
                } else {
                    const isMobile = /Android|iPhone|iPad/i.test(navigator.userAgent);
                    if (isMobile) {
                        const url = `nmap://route/public?slat=${startLoc.lat}&slng=${startLoc.lng}&sname=${encodeURIComponent(startLoc.krName)}&dlat=${endLoc.lat}&dlng=${endLoc.lng}&dname=${encodeURIComponent(endLoc.krName)}&appname=seoul_trip_helper`;
                        window.location.href = url;
                    } else {
                        const url = `https://map.naver.com/p/directions/${startLoc.lng},${startLoc.lat},${encodeURIComponent(startLoc.krName)}/${endLoc.lng},${endLoc.lat},${encodeURIComponent(endLoc.krName)}/-/transit?c=15.00,0,0,0,dh`;
                        window.open(url, '_blank');
                    }
                }
            };

            const handleAddLocation = () => {
                if (!newLocName || !newLocLat || !newLocLng) { alert("è«‹å¡«å¯«å®Œæ•´è³‡è¨Š"); return; }
                const newLoc = {
                    id: Date.now(),
                    name: newLocName,
                    krName: newLocKrName || newLocName,
                    lat: parseFloat(newLocLat),
                    lng: parseFloat(newLocLng),
                    desc: newLocNote,
                    category: "OTHER", // æ‰‹å‹•æ–°å¢é è¨­åˆ†é¡
                    isCustom: true
                };
                const updated = [...customLocs, newLoc];
                setCustomLocs(updated);
                localStorage.setItem('myCustomLocations', JSON.stringify(updated));
                setNewLocName(""); setNewLocKrName(""); setNewLocNote(""); setNewLocLat(""); setNewLocLng("");
                setShowAddModal(false);
            };

            return (
                <div className="max-w-md mx-auto min-h-screen bg-gray-50 pb-20 relative">
                    {/* Header */}
                    <div className="bg-gradient-to-r from-blue-600 to-indigo-700 p-6 text-white rounded-b-3xl shadow-lg mb-4">
                        <h1 className="text-2xl font-bold mb-1">é¦–çˆ¾è¡Œç¨‹åŠ©æ‰‹</h1>
                        <p className="text-blue-100 text-sm opacity-90">v8.0 åœ°åœ–å…¨è¦½ç‰ˆ</p>
                        
                        {/* é ‚éƒ¨æŒ‰éˆ•å€ */}
                        <div className="flex gap-2 mt-4 justify-end">
                            <button onClick={() => setShowAddModal(true)} className="bg-white/20 hover:bg-white/30 text-white px-3 py-1 rounded-full text-sm backdrop-blur-sm">
                                <i className="fas fa-plus mr-1"></i> æ–°å¢
                            </button>
                        </div>
                    </div>

                    <div className="px-4 space-y-4">
                        
                        {/* 1. åˆ†é¡ç¯©é¸åˆ— */}
                        <div className="flex gap-2 overflow-x-auto category-scroll pb-1">
                            {Object.entries(CATEGORIES).map(([key, label]) => (
                                <button
                                    key={key}
                                    onClick={() => setFilterCategory(key)}
                                    className={`whitespace-nowrap px-4 py-2 rounded-full text-sm font-bold transition-all shadow-sm
                                        ${filterCategory === key 
                                            ? 'bg-indigo-600 text-white ring-2 ring-indigo-200' 
                                            : 'bg-white text-gray-600 hover:bg-gray-100'}`}
                                >
                                    {label}
                                </button>
                            ))}
                        </div>

                        {/* 2. é¸æ“‡å™¨å¡ç‰‡ */}
                        <div className="card p-5 space-y-5">
                            <div className="relative">
                                <label className="block text-xs font-bold text-gray-400 uppercase tracking-wide mb-1 ml-1">
                                    <span><i className="fas fa-map-marker-alt text-green-500 mr-1"></i> å‡ºç™¼åœ°</span>
                                </label>
                                <select value={startPoint} onChange={(e) => { setStartPoint(e.target.value); if(e.target.value==="current") getUserLocation(); }} className="w-full p-4 bg-gray-50 border border-gray-200 rounded-xl text-gray-800 font-medium focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none">
                                    <option value="current">ğŸ“ æˆ‘çš„ç›®å‰ä½ç½® (GPS)</option>
                                    <optgroup label="åœ°é»æ¸…å–®">
                                        {/* é€™è£¡ç°¡å–®åˆ—å‡ºæ‰€æœ‰åœ°é»ï¼Œæˆ–ä¾éœ€æ±‚éæ¿¾ */}
                                        {allLocations.map(l => <option key={l.id} value={l.id}>{l.name}</option>)}
                                    </optgroup>
                                </select>
                            </div>
                            
                            <div className="flex items-center justify-center -my-2 relative z-10">
                                <div className="bg-white p-2 rounded-full shadow-sm border border-gray-100"><i className="fas fa-arrow-down text-gray-300"></i></div>
                            </div>

                            <div className="relative">
                                <label className="block text-xs font-bold text-gray-400 uppercase tracking-wide mb-1 ml-1">
                                    <i className="fas fa-map-pin text-red-500 mr-1"></i> ç›®çš„åœ° 
                                    <span className="text-indigo-500 ml-2 text-[10px]">({filterCategory === 'ALL' ? 'å…¨éƒ¨' : CATEGORIES[filterCategory]})</span>
                                </label>
                                <select value={endPoint} onChange={(e) => setEndPoint(e.target.value)} className="w-full p-4 bg-gray-50 border border-gray-200 rounded-xl text-gray-800 font-medium focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none">
                                    {/* æ ¹æ“šç¯©é¸çµæœé¡¯ç¤º Option */}
                                    {filteredLocations.map(l => (
                                        <option key={l.id} value={l.id}>{l.name}</option>
                                    ))}
                                    {filteredLocations.length === 0 && <option disabled>æ­¤åˆ†é¡ç„¡åœ°é»</option>}
                                </select>
                            </div>
                        </div>

                        {/* 3. è¨ˆç®—çµæœèˆ‡æŒ‰éˆ• */}
                        <div className="card p-6 text-center border-l-4 border-indigo-500">
                            <p className="text-gray-400 text-xs font-semibold uppercase tracking-wider mb-2">ç›´ç·šè·é›¢</p>
                            <div className="text-4xl font-extrabold text-gray-800 mb-1">{distanceDisplay} <span className="text-lg text-gray-500 font-medium">km</span></div>
                        </div>

                        <div className="grid grid-cols-2 gap-4 pt-2">
                            <button onClick={() => openMap('google')} className="btn-google py-4 px-4 rounded-xl font-bold shadow-lg flex flex-col items-center justify-center gap-2">
                                <i className="fab fa-google text-2xl"></i> <span>Google Map</span>
                            </button>
                            <button onClick={() => openMap('naver')} className="btn-naver py-4 px-4 rounded-xl font-bold shadow-lg flex flex-col items-center justify-center gap-2">
                                <span className="text-2xl font-black">N</span> <span>Naver Map</span>
                            </button>
                        </div>

                        {/* 4. å…¨æ™¯åœ°åœ–å€åŸŸ (æ–°å¢) */}
                        <div className="mt-8">
                            <h3 className="text-gray-600 font-bold text-sm ml-1 mb-3 flex items-center">
                                <i className="fas fa-map-marked-alt mr-2 text-indigo-500"></i> åœ°é»å…¨è¦½åœ–
                            </h3>
                            <div className="bg-white p-2 rounded-2xl shadow-lg border border-gray-100">
                                <div id="global-map"></div>
                                <p className="text-center text-[10px] text-gray-400 mt-2">
                                    * é¡¯ç¤ºæ‰€æœ‰åœ°é»ä½ç½®ï¼Œé»æ“Šåœ–é‡˜å¯æŸ¥çœ‹è©³æƒ…
                                </p>
                            </div>
                        </div>

                        {/* 5. ç›®çš„åœ°è©³æƒ… */}
                        {endLoc && (
                            <div className="mt-6">
                                <h3 className="text-gray-500 font-bold text-sm ml-1 mb-2"><i className="fas fa-info-circle mr-2"></i>ç›®çš„åœ°è³‡è¨Š</h3>
                                <div className="bg-white p-5 rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                                    <div className="flex flex-wrap gap-2 mb-2">
                                        <h4 className="font-bold text-gray-800 text-lg mr-2">{endLoc.name}</h4>
                                        <span className="text-[10px] bg-gray-100 text-gray-600 px-2 py-1 rounded-full self-center">
                                            {CATEGORIES[endLoc.category] || "å…¶ä»–"}
                                        </span>
                                    </div>
                                    <p className="text-gray-500 text-sm">{endLoc.desc}</p>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Add Modal (Simplified) */}
                    {showAddModal && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm">
                            <div className="bg-white rounded-2xl w-full max-w-sm p-6 shadow-2xl">
                                <h2 className="text-xl font-bold mb-4 text-gray-800">æ‰‹å‹•æ–°å¢</h2>
                                <div className="space-y-3">
                                    <input type="text" value={newLocName} onChange={e => setNewLocName(e.target.value)} placeholder="åç¨±" className="w-full p-2 border rounded-lg"/>
                                    <div className="grid grid-cols-2 gap-2">
                                        <input type="number" value={newLocLat} onChange={e => setNewLocLat(e.target.value)} placeholder="ç·¯åº¦ Lat" className="w-full p-2 border rounded-lg"/>
                                        <input type="number" value={newLocLng} onChange={e => setNewLocLng(e.target.value)} placeholder="ç¶“åº¦ Lng" className="w-full p-2 border rounded-lg"/>
                                    </div>
                                    <p className="text-xs text-gray-400">* è«‹å…ˆå¾ Google Map è¤‡è£½åº§æ¨™å¡«å…¥</p>
                                    <div className="flex gap-2 mt-4">
                                        <button onClick={() => setShowAddModal(false)} className="flex-1 py-2 bg-gray-100 rounded-lg text-gray-600">å–æ¶ˆ</button>
                                        <button onClick={handleAddLocation} className="flex-1 py-2 bg-indigo-600 text-white rounded-lg">å„²å­˜</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
